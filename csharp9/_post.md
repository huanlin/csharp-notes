# C# 9

æœ¬ç« è¦ä»‹ç´¹çš„æ˜¯ C# 9 çš„æ–°å¢èªæ³•å’Œæ”¹é€²ä¹‹è™•ï¼ŒåŒ…æ‹¬ï¼š

- [é ‚å±¤èªå¥](#é ‚å±¤èªå¥)
- [åˆå§‹é™å®šè¨­å®šå­](#åˆå§‹é™å®šè¨­å®šå­)
---

## é ‚å±¤èªå¥

é ‚å±¤èªå¥ï¼ˆtop-level statementsï¼‰æˆ–æœ€ä¸Šå±¤èªå¥ï¼ŒæŒ‡çš„æ˜¯è®“æˆ‘å€‘åœ¨ç¨‹å¼ä¸­çœç•¥ `Program` é¡åˆ¥å’Œ `Main` æ–¹æ³•çš„ã€Œå¤–æ®¼ã€ï¼Œä¹Ÿå°±ç­‰æ–¼æ˜¯åœ¨æ•´å€‹ C# ç¨‹å¼æª”æ¡ˆçš„æœ€å¤–å±¤ç›´æ¥æ’°å¯«é™³è¿°å¼ã€‚

C# 9 ä¹‹å‰çš„å¯«æ³•ï¼š

~~~~~~~~csharp
using System;

class Program
{
    static void Main(string[] args)
    {
        Console.WriteLine ("Hello, world");        
    }
}
~~~~~~~~

C# 9 ä¹‹å¾Œåªè¦å…©è¡Œï¼š

~~~~~~~~csharp
using System;
Console.WriteLine ("Hello, world");
~~~~~~~~

å¯«åœ¨é ‚å±¤çš„é™³è¿°å¼æœƒè¢«ç·¨è­¯å™¨è¦–ç‚º `Main` æ–¹æ³•çš„ä¸€éƒ¨ä»½ï¼Œè€Œä¸”ä¾ç„¶å¯ä»¥å­˜å– `args` åƒæ•¸ã€‚é ‚å±¤èªå¥ä¹Ÿå¯ä»¥åŒ…å«å…¶ä»–æ–¹æ³•ï¼ˆæœƒæˆç‚º `Main` æ–¹æ³•çš„å€åŸŸå‡½å¼ï¼‰ã€‚

ç¯„ä¾‹ï¼š

~~~~~~~~csharp
Hello(args.Length > 0 ? args[0] : ""); 

static void Hello(string arg)
{
    Console.WriteLine($"Hello {arg}");
}

Console.WriteLine("Hello 2"); 
~~~~~~~~

å¦‚æœåŸ·è¡Œæ™‚æ²’æœ‰å‚³å…¥å‘½ä»¤åˆ—å¼•æ•¸ï¼ŒåŸ·è¡Œçµæœæœƒæ˜¯ï¼š

~~~~~~~~
Hello
Helo 2
~~~~~~~~

> è©¦è©¦çœ‹ï¼šhttps://dotnetfiddle.net/htGaC9

é ‚å±¤èªå¥å¯ä»¥åŒ…å«ä¸‰ç¨®é™³è¿°å¼ï¼Œæ’°å¯«çš„é †åºæ˜¯ï¼š

1. `using` å‘½åç©ºé–“ã€‚
2. é™³è¿°å¼ã€å‡½å¼ã€‚
3. è‡ªè¡Œå®šç¾©çš„å‘½åç©ºé–“èˆ‡å‹åˆ¥ã€‚

å…¶ä¸­åªæœ‰ç¬¬ 2 å€‹éƒ¨åˆ†æ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚æ­¤å¤–ï¼Œå¦‚æœæŠŠç¬¬ 2 å’Œ 3 éƒ¨åˆ†çš„æ’°å¯«é †åºé¡›å€’ï¼Œç·¨è­¯å™¨æœƒå ±éŒ¯ã€‚

## åˆå§‹é™å®šè¨­å®šå­

åˆå§‹é™å®šè¨­å®šå­ï¼ˆinit-only settersï¼‰æ˜¯ç”¨ä¾†é™å®šæŸå€‹å±¬æ€§åªèƒ½åœ¨ç‰©ä»¶åˆå§‹åŒ–çš„éç¨‹ä¸­è³¦å€¼ã€‚ä¹Ÿå°±æ˜¯èªªï¼Œåªæœ‰ä»¥ä¸‹é€™å¹¾å€‹åœ°æ–¹æ‰å¯ä»¥è¨­å®š init-only å±¬æ€§çš„åˆå§‹å€¼ï¼š

1. å»ºæ§‹å¼ï¼ˆconstructorï¼‰
2. å±¬æ€§åˆå§‹è¨­å®šå¼ï¼ˆproperty initializerï¼‰
3. ç‰©ä»¶åˆå§‹è¨­å®šå¼ï¼ˆobject initializerï¼‰

å…¶ä»–åœ°æ–¹å‰‡ä¸å…è¨±ä¿®æ”¹é‚£å€‹å±¬æ€§çš„å…§å®¹ã€‚

å¦‚è¦é™å®šæŸå€‹å±¬æ€§åªèƒ½åœ¨ç‰©ä»¶åˆå§‹åŒ–çš„éç¨‹ä¸­è³¦å€¼ï¼ˆå³ init-only å±¬æ€§ï¼‰ï¼Œåªè¦åœ¨å®£å‘Šå±¬æ€§çš„æ™‚å€™æŠŠé—œéµå­— `set` æ”¹ç‚º `init` å³å¯ã€‚åƒè€ƒä»¥ä¸‹ç¯„ä¾‹ï¼š

~~~~~~~~csharp
class Student
{
    public int Id { get; init; } = 1; // OK!
    
    public Student()
    {
        Id = 2; // OK!
    }
}
~~~~~~~~

èªªæ˜ï¼š

- ç¬¬ 3 è¡Œï¼šå®£å‘Š `Id` å±¬æ€§ç‚º init-onlyï¼Œä¸¦ä»¥å±¬æ€§åˆå§‹è¨­å®šå¼ä¾†å°‡ åˆå§‹å€¼è¨­å®šç‚º 1ã€‚
- ç¬¬ 7 è¡Œï¼šåœ¨å»ºæ§‹å¼ç•¶ä¸­è¨­å®š `Id` å±¬æ€§å€¼ç‚º 2ã€‚

ä»¥ä¸‹ç¯„ä¾‹å‰‡æ˜¯é€éç‰©ä»¶åˆå§‹è¨­å®šå¼ä¾†è³¦å€¼ï¼š

~~~~~~~~csharp
var john = new Student { Id = 3 }; // OK!
john.Id = 2; // ç·¨è­¯å¤±æ•—! ä¸å¯ä¿®æ”¹æ­¤å±¬æ€§å€¼ã€‚
~~~~~~~~

> è©¦è©¦çœ‹ï¼šhttps://dotnetfiddle.net/uTglcH

å”¯è®€å±¬æ€§èˆ‡ init-only å±¬æ€§çš„è¡Œç‚ºé¡ä¼¼ï¼Œä½†å”¯è®€å±¬æ€§æœ‰å€‹ç¼ºé»ï¼šå¦‚æœé€éå»ºæ§‹å¼çš„åƒæ•¸ä¾†è¨­å®šåˆå§‹å€¼ï¼Œå¯èƒ½æœƒå¢åŠ æ—¥å¾Œä¿®æ”¹çš„éº»ç…©ã€‚ä¾‹å¦‚ï¼š

~~~~~~~~csharp
class Student
{
    public int Id { get; };
    
    public Student(int id)
    {
        Id = id;
    }
}
~~~~~~~~

å¦‚ä¸Šä¾‹æ‰€æ˜¯ï¼Œå¤–ç•Œå¦‚æœè¦è¨­å®šå”¯è®€å±¬æ€§çš„å€¼ï¼Œå”¯ä¸€é€”å¾‘æ˜¯é€éç‰©ä»¶çš„å»ºæ§‹å¼ã€‚ç„¶è€Œï¼Œæ­¤åšæ³•æœ‰å€‹ç¼ºé»ï¼šæ—¥å¾Œå¦‚æœè¦æ›¿å»ºæ§‹å¼å¢åŠ æ–°çš„åƒæ•¸ï¼Œå°‡é€£å¸¶å½±éŸ¿æ‰€æœ‰ç”¨æˆ¶ç«¯ç¨‹å¼ç¢¼ï¼ˆå¿…é ˆä¿®æ”¹ç¨‹å¼ï¼Œå¦å‰‡ç„¡æ³•ç·¨è­¯ï¼‰ã€‚è‹¥è¦é¿å…é€™äº›éº»ç…©ï¼Œå°±åªèƒ½åœ¨çµ¦å»ºæ§‹å¼å¢åŠ åƒæ•¸çš„æ™‚å€™æä¾›åƒæ•¸çš„é è¨­å€¼ã€‚ç¾åœ¨æœ‰äº† init-only å±¬æ€§ï¼Œå°±ä¸ç”¨å†ç³¾çµäº†ï¼šå®ƒä¸åƒ…å…·æœ‰å”¯è®€å±¬æ€§çš„å¥½è™•ï¼Œè€Œä¸”å¤–ç•Œå¯ä»¥é€éç‰©ä»¶åˆå§‹è¨­å®šå¼ä¾†è¨­å®šé€™äº› init-only å±¬æ€§çš„åˆå§‹å€¼ã€‚

> å‚™è¨»ï¼šinit-only å±¬æ€§é‚„æœ‰ä¸€å€‹ç”¨è™•ï¼Œæ˜¯è·Ÿ `record` å‹åˆ¥ä¸€èµ·æ­é…ä½¿ç”¨ã€‚é€™å€‹éƒ¨åˆ†è«‹åƒè€ƒ `record` ä¸€ç¯€çš„èªªæ˜ï¼ˆTODOï¼‰ã€‚



---

ï½ENDï½

ğŸ‘‰[è¿”å›é¦–é ](https://github.com/huanlin/LearningNotes#readme)
